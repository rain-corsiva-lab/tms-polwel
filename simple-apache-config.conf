<VirtualHost *:80>
    ServerName polwel-pdms.customized3.corsivalab.xyz
    DocumentRoot /www/wwwroot/polwelpdms/dist
    
    # Frontend - serve static files
    <Directory /www/wwwroot/polwelpdms/dist>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Handle React Router (SPA routing)
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_URI} !^/api/
        RewriteCond %{REQUEST_URI} !^/health
        RewriteRule . /index.html [L]
    </Directory>
    
    # API Proxy to Backend
    ProxyPreserveHost On
    
    # Health check endpoint (direct proxy)
    ProxyPass /health http://localhost:3001/health
    ProxyPassReverse /health http://localhost:3001/health
    
    # API endpoints - preserve full path including /api/ prefix
    ProxyPass /api http://localhost:3001/api
    ProxyPassReverse /api http://localhost:3001/api
    
    # Security Headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "DENY"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Permissions-Policy "camera=(), microphone=(), geolocation=()"
    
    # Logs
    ErrorLog /www/wwwlogs/polwel_error.log
    CustomLog /www/wwwlogs/polwel_access.log combined
</VirtualHost>
