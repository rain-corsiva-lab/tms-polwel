<VirtualHost *:80>
    ServerName backend-polwel-pdms.customized3.corsivalab.xyz
    
    # All requests go to Node.js backend
    ProxyPreserveHost On
    ProxyPass / http://localhost:3001/
    ProxyPassReverse / http://localhost:3001/
    
    # Security Headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "DENY"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Permissions-Policy "camera=(), microphone=(), geolocation=()"
    
    # CORS Headers for frontend domain
    Header always set Access-Control-Allow-Origin "https://polwel-pdms.customized3.corsivalab.xyz"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, PATCH"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
    Header always set Access-Control-Allow-Credentials "true"
    
    # Handle OPTIONS requests for CORS
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
    
    # Logs
    ErrorLog /www/wwwlogs/backend_polwel_error.log
    CustomLog /www/wwwlogs/backend_polwel_access.log combined
</VirtualHost>
